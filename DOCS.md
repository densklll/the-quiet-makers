# The Quiet Makers — Документация

Проект: платформа, помогающая людям находить и поддерживать благотворительные проекты, соответствующие их ценностям и интересам.

## Быстрый старт

```bash
# Требования
# Node.js >= 18.17

# Установка зависимостей
npm install

# Запуск режима разработки
npm run dev
```

Открыть в браузере: `http://localhost:3000/the-quiet-makers`

Обратите внимание: используется basePath `/the-quiet-makers` (см. конфиг), поэтому корневой URL в dev и на проде отличается от `/`.

## Архитектура и стек

- Next.js 14 (App Router) + статическая генерация (SSG) с `output: 'export'`
- React 18, TypeScript (строгий режим)
- Tailwind CSS для стилизации
- Framer Motion для анимаций
- React Icons для иконок
- Простая i18n (английский/русский) через собственный контекст

Ключевые файлы конфигурации:
- `next.config.js`:
  - `output: 'export'`
  - `basePath` и `assetPrefix` = `/the-quiet-makers`
  - `images`: `unoptimized: true` (для SSG/`next export`), `remotePatterns` (`placehold.co`, `images.unsplash.com`), `dangerouslyAllowSVG: true` (аккуратно с безопасностью)
- `tailwind.config.js`: пути сканирования, расширения темы (цвета, тени, анимации)
- `tsconfig.json`: строгий TS, алиас `@/*` на корень
- `postcss.config.js`: Tailwind + Autoprefixer

## Структура каталогов

- `app/`
  - `page.tsx`: главная страница
  - `about/`, `projects/`, `quiz/`, `register/`, `login/`, `favorites/`, `collaborations/`, `happiness/*`: страницы
  - `project-details/[id]/`: детали проекта (динамический маршрут)
  - `project-selection/`: альтернативный подбор проектов по шагам
  - `components/`: общие компоненты (`Header`, `Footer`, `ProjectCard`, `ProjectTags`, `QuizQuestion`, `ErrorBoundary`)
  - `globals.css`: глобальные стили Tailwind
- `lib/`
  - `api.ts`: интерфейсы и мок-данные проектов + функции выборки
  - `i18n/`: `I18nContext` и словари `en.ts`/`ru.ts`
- `public/`: статические ресурсы (`noise.svg`, изображения)

## Локализация (i18n)

- Провайдер `I18nProvider` подключён в `app/layout.tsx` и оборачивает всё приложение
- Текущая локаль хранится в cookie `locale`. По умолчанию — `en`. При переключении обновляется `<html lang>` (на клиенте)
- Переключатель языка: в `Header` (кнопка `EN/RU`)
- Словари: `lib/i18n/dictionaries/en.ts` и `ru.ts`
- Функция перевода `t(key, vars?)` поддерживает плейсхолдеры `{var}`
- Примечание: раздел `projectsData` в `en.ts` подготовлен для локализации карточек по `id`, но пока не используется

## Данные и API

`lib/api.ts` содержит:
- Типы `Story` и `Project`
- Массив мок-данных `mockProjects` (3 проекта)
- API-функции:
  - `getAllProjects()` — все проекты
  - `getProjectById(id)` — проект по ID
  - `getProjectsByTags(tags)` — фильтр по тегам (строковое сравнение)

Изображения в мок-данных указываются как пути `"/images/..."`. Для корректной работы нужно:
- добавить соответствующие файлы в `public/images/...`, или
- временно заменить на разрешённые внешние URL (`https://placehold.co/...` или `https://images.unsplash.com/...`, разрешены в `next.config.js`)

## Страницы и маршруты

- `/the-quiet-makers` — главная (`app/page.tsx`): хиро, категории, «как это работает», CTA, i18n
- `/the-quiet-makers/about` — о платформе: миссия/ценности/CTA, i18n
- `/the-quiet-makers/projects` — список проектов:
  - Серверный компонент (`app/projects/page.tsx`) синхронно получает данные из `getAllProjects` и отдаёт клиентскому компоненту — при `output: 'export'` это SSG (не SSR)
  - Клиентская часть (`app/projects/ProjectsClient.tsx`) реализует поиск, выбор тегов, отображение карточек, i18n
- `/the-quiet-makers/project-details/[id]` — детали проекта (динамика, SSG):
  - `generateStaticParams` генерирует страницы по известным `id: ["1","2","3"]`
  - `ProjectDetailsClient` — теги, прогресс, форма пожертвования (демо), истории, галерея, модалка успеха
- `/the-quiet-makers/quiz` — квиз из 5 шагов; по завершении редирект на `/projects` с query-параметрами (используются для отображения пояснительного текста)
- `/the-quiet-makers/project-selection` — альтернативный подбор: шаги теги → категории → формат; редирект на `/projects` с query-параметрами
- `/the-quiet-makers/favorites` — избранное (локальные мок-данные; не из `lib/api.ts`)
- `/the-quiet-makers/collaborations` — коллаборации и мини-проекты (часть ссылок — заглушки)
- `/the-quiet-makers/happiness/education|interviews|stories` — контентные страницы (часть ссылок — заглушки)
- `/the-quiet-makers/login` и `/the-quiet-makers/register` — формы (валидация на клиенте)

## Стили и UI/UX

- Tailwind + дополнительные утилиты в `app/globals.css` (кнопки, карточки, прогресс-бары, теги, модалки)
- Фон страницы использует `public/noise.svg`
- Анимации — `framer-motion`
- Иконки — `react-icons`

## Запуск, сборка, предпросмотр

- Dev:
  ```bash
  npm run dev
  # открыть http://localhost:3000/the-quiet-makers
  ```
- Сборка (SSG):
  ```bash
  npm run build
  # результат в каталоге out/
  ```
- Предпросмотр статики:
  ```bash
  npx serve out
  # или npm i -g serve && serve out
  ```

Важно: при `output: 'export'` команда `next start` неприменима для каталога `out/`. Используйте любой статический сервер.

## Деплой на GitHub Pages

- Настройки уже подготовлены под GitHub Pages (подпуть репозитория):
  - `basePath: '/the-quiet-makers'`
  - `assetPrefix: '/the-quiet-makers'`
- Процесс:
  1) Выполнить `npm run build` — получим `out/`
  2) Задеплоить содержимое `out/` в ветку `gh-pages`
  3) Включить GitHub Pages (Source: `gh-pages`)

После деплоя сайт будет доступен по адресу вида: `https://<owner>.github.io/the-quiet-makers/`

## Известные ограничения и рекомендации

1) Соответствие тегов и локализации (влияет на фильтры):
   - В `mockProjects` теги на русском (например, `"Люди"`), а при англоязычном UI `t()` возвращает `"People"`. Фильтрация в `ProjectsClient` сравнивает строки и перестаёт работать в EN.
   - Рекомендация: хранить теги как стабильные ID (`people`, `animals`, `nature`, `children`, `ecology`) и переводить только при отображении; либо маппить выбранные переводы обратно к исходным значениям перед фильтрацией.

2) Изображения из мок-данных:
   - Пути вида `"/images/..."` требуют существования файлов в `public/images/...`. Сейчас часть путей отсутствует.
   - Рекомендации: добавить изображения в репозиторий либо использовать внешние источники (`placehold.co`/`images.unsplash.com`, разрешены в конфиге).

3) Подсветка слова на странице `about`:
   - Сейчас используется `split().join('<span ...>')`, что выведет HTML-теги как текст.
   - Рекомендации: разметить слово в JSX (разбить строку на части) либо применить `dangerouslySetInnerHTML` (с осторожностью).

4) BasePath и фон `noise.svg`:
   - В `globals.css` указан `url('/noise.svg')`. На GitHub Pages требуется `'/the-quiet-makers/noise.svg'`.
   - Рекомендации: импортировать SVG и использовать через `next/image` или инлайн-data URL; либо вычислять путь с учётом `basePath`.

5) Query-параметры из `quiz`/`project-selection`:
   - На странице `projects` параметры из `quiz` используются для поясняющего текста, но не участвуют в фактической фильтрации.
   - Рекомендации: связать выбранные `categories/format/tags` с реальной фильтрацией либо заполнять начальные фильтры из URL.

6) Несуществующие страницы по ссылкам (заглушки):
   - В `favorites`, `collaborations`, `happiness/*` встречаются ссылки вида `/.../1`, `/.../all`, которые не реализованы и приведут к 404/"Проект не найден".
   - Рекомендации: создать соответствующие маршруты или заменить ссылки на существующие страницы/якоря.

7) Компонент `ProjectCard`:
   - Содержит ссылку формата `/projects/${id}`, тогда как детали проекта находятся на `/project-details/[id]`.
   - Рекомендации: при использовании `ProjectCard` обновить ссылку на `/project-details/${id}`.

8) Детали SSG для страниц проектов:
   - `generateStaticParams` генерирует страницы только для `id: ["1","2","3"]`. Иные `id` вернут заглушку "Проект не найден".
   - Рекомендации: при добавлении проекта обновлять и список `id` для SSG.

9) Учёт `basePath` в определении главной страницы:
   - В `Header` используется `pathname === '/'` для определения главной страницы. При наличии `basePath` это условие может не сработать как ожидается.
   - Рекомендации: учитывать `basePath` при сравнении (или проверить поведение `usePathname` в текущей версии Next.js).

10) Безопасность изображений и экспорт:
   - В `next.config.js` установлено `images.unoptimized: true`, что корректно для `next export`, но отключает оптимизацию картинок.
   - Рекомендации: при переходе на серверный хостинг без `export` вернуть оптимизацию изображений.

11) `projectsData` в `en.ts` не используется:
   - В `en.ts` есть раздел `projectsData` для локализации данных проектов по `id`, но он не задействован.
   - Рекомендации: интегрировать при выводе данных проектов или удалить как неиспользуемый.

## Расширение функциональности

- Добавить проект:
  1) Добавить элемент в `mockProjects` в `lib/api.ts`
  2) Обновить `generateStaticParams` в `app/project-details/[id]/page.tsx` (добавить новый `id` для SSG)
  3) Добавить изображения в `public/images/...` или указать внешний URL
- Добавить страницу: создать `app/<route>/page.tsx` (Next App Router подключит автоматически)
- Добавить перевод: добавить ключ в оба словаря `en.ts` и `ru.ts`; использовать `t('путь.к.ключу')`
- Изменить стиль: редактировать `globals.css` и компоненты; Tailwind классы доступны во всех JSX

## Роадмап улучшений

- Нормализовать теги (ID + перевод) и связать фильтры с URL-параметрами
- Добавить/исправить изображения проектов в `public/images`
- Вынести «Избранное» на общий источник данных (`lib/api.ts`/API) + сохранить в `localStorage`/бекенде
- Корректно подсветить слово на странице `about`
- Обновить обработку путей с учётом `basePath` (фон/ассеты, определение главной страницы)
- Интегрировать реальный API (SSR/ISR для списков и деталей) при отказе от `next export`
- Локализовать содержимое проектов (использовать `projectsData`), или удалить неиспользуемые структуры
- Реализовать отсутствующие страницы по ссылкам-заглушкам (collaborations/happiness)
- Рассмотреть возврат `images.unoptimized: false` при серверном хостинге

## FAQ

- Где глобальные стили? — `app/globals.css`
- Как добавить новый маршрут? — создать `app/<route>/page.tsx`
- Как добавить перевод? — обновить `lib/i18n/dictionaries/en.ts` и `ru.ts`
- Как отрисовывать новые поля проекта? — расширить интерфейс `Project` и компоненты отображения (`ProjectsClient`, `ProjectDetailsClient`)
- Как собрать и задеплоить на GitHub Pages? — `npm run build` → содержимое `out/` в ветку `gh-pages`, настроить Pages

## Лицензия

Смотрите `README.md` (MIT).
